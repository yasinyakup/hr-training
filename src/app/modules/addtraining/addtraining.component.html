<h1>Add Training Record</h1>

<div class="container"  novalidate> 
  <form [formGroup]="formGroup" (ngSubmit)="onSubmit(formGroup.value)" class="form">

    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="20px">
      <mat-form-field fxFlex="50" class="form-element" appearance="fill">
      <mat-label>Training Name<span class="star">*</span></mat-label>
      <mat-select formControlName="tn">
        <mat-option *ngFor="let tn of tns" [value]="tn">
          {{tn.name}}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="!formGroup.controls['tn'].valid && formGroup.controls['tn'].touched">
        Required field.
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="50"  class="form-element" appearance="fill">
      <mat-label>Training date<span class="star">*</span></mat-label>
      <input matInput [matDatepicker]="picker" formControlName="td">
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker color="primary"></mat-datepicker>
      <mat-error *ngIf="!formGroup.controls['td'].valid && formGroup.controls['td'].touched">
        Required field.
      </mat-error>
    </mat-form-field>
  </div>


  <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="20px">
    <mat-form-field fxFlex="50" class="form-element" appearance="fill">
    <mat-label>Enter section <span class="star">*</span></mat-label>
    <mat-select formControlName="section">
      <mat-option *ngFor="let section of sections" [value]="section">
        {{section}}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="!formGroup.controls['section'].valid && formGroup.controls['tn'].touched">
      Required field.
    </mat-error>
  </mat-form-field>

  <mat-form-field fxFlex="50" class="form-element">
    <input matInput placeholder="Enter training duration *" formControlName="hour">
    <mat-error *ngIf="!formGroup.controls['section'].valid && formGroup.controls['tn'].touched">
      Required field.
    </mat-error>
  </mat-form-field>
</div>

  
  <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="20px">

    <mat-form-field fxFlex="50" class="form-element" appearance="fill">
      <mat-label>Department</mat-label>
      <mat-select (selectionChange)="getSelectedDept($event)">
        <mat-option *ngFor="let dept of depts" [value]="dept" >
          {{dept.deptName}}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field fxFlex="50" class="form-element">
      <input matInput placeholder="Enter EMP Code/Name" (keyup)="applyFilter($event)"
      [formControl]="myControl" formControlName="emp"
             [matAutocomplete]="auto">
             <button mat-icon-button matSuffix *ngIf="myControl.value" type="button" (click)="addEmp()" >
              <mat-icon class="mat-icon-add">add</mat-icon>
              </button>
<!--
              <mat-error *ngIf="!formGroup.controls['emp'].valid">
        Required field.
      </mat-error>
-->

      <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
        <mat-option *ngFor="let option of options" [id]="option.empNo" [value]="option.fullName+ ', ' +option.empNo">
          {{option.fullName + ", " + option.empNo}} 
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
  </div>


  <table mat-table [dataSource]="dataSourceByDept" matSort>

    <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>No.</th>
        <td mat-cell *matCellDef="let row; let i = index;"> {{i+1}} </td>
    </ng-container>
    <ng-container  matColumnDef="empNo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>TC/EMP Code</th>
        <td mat-cell *matCellDef="let row">{{ row.empNo }}</td>
    </ng-container>
    <ng-container  matColumnDef="fullName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
        <td mat-cell *matCellDef="let row">{{ row.fullName }}</td>
    </ng-container>
    <ng-container  matColumnDef="dept">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Department</th>
        <td mat-cell *matCellDef="let row">{{ row.dept }}</td>
    </ng-container>
    <ng-container  matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
        <td mat-cell *matCellDef="let row">{{ row.title }}</td>
    </ng-container>
    <ng-container  matColumnDef="hireDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Hire Date</th>
        <td mat-cell *matCellDef="let row">{{row.hireDate.substring(0, 10)  }}</td>
    </ng-container>
    <ng-container  matColumnDef="dob">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>DOB</th>
        <td mat-cell *matCellDef="let row">{{ row.dob.substring(0, 10) }}</td>
    </ng-container>
    <ng-container  matColumnDef="gender">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Gender</th>
        <td mat-cell *matCellDef="let row">{{ row.gender }}</td>
    </ng-container>

    <ng-container  matColumnDef="delete">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Delete</th>
      <td mat-cell *matCellDef="let row"  (click)="deleteEmp(row)">
          <button mat-menu-item type="button">
          <span><mat-icon>delete</mat-icon></span>
        </button>
      </td>
  </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  </table>

    <div class="form-element">
      <button mat-raised-button color="primary" type="submit" class="button" [disabled]="!formGroup.valid">Submit Form</button>
    </div>

  </form>
</div>